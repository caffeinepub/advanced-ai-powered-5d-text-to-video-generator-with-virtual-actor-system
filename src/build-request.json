{
  "kind": "build_request",
  "title": "Add sample preview generation before full clip generation and download",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Add a user-facing option to generate and watch a short \"sample preview\" from the current prompt before running the existing full clip generation workflow.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "I want to add an option for users to preview sample outputs before generating a full clip and download"
        ]
      },
      "acceptanceCriteria": [
        "On the Create flow, users can trigger a \"Preview sample\" action that generates a short preview clip (shorter than the configured full duration) from the current prompt.",
        "After a sample preview completes, the UI plays the sample preview in the existing preview player area.",
        "The sample preview action is clearly labeled in English (e.g., \"Preview sample\") and is available before running full generation."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Ensure sample preview generation does not persist anything to the user’s library and does not call backend mutations that create Video/Audio/Music/SceneConfig records.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "preview sample outputs before generating a full clip"
        ]
      },
      "acceptanceCriteria": [
        "After generating a sample preview, the user’s Video Library does not show a new item created by the preview.",
        "No backend \"addVideo\" / \"addAudio\" / \"addBackgroundMusic\" / \"addSceneConfig\" mutations are executed as part of sample preview generation.",
        "Refreshing the page after only generating a sample preview does not reveal any new saved media artifacts."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Update the full generation flow so that users can explicitly choose to run \"Generate full clip\" after previewing, and keep the existing full workflow behavior (including saving to library and enabling download).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "before generating a full clip and download"
        ]
      },
      "acceptanceCriteria": [
        "A distinct \"Generate full clip\" action is available and triggers the existing full pipeline (including upload to the user library).",
        "After full generation completes, the existing download control works as it does today for the generated full clip.",
        "Generating a full clip still requires Internet Identity login (same gating behavior as current generation)."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Adjust the Create UI to present both actions (sample preview and full generation) with clear states/disabled behavior while generation is in progress (e.g., prevent triggering both simultaneously).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "add an option for users to preview sample outputs before generating a full clip"
        ]
      },
      "acceptanceCriteria": [
        "While a sample preview is generating, both preview and full generation actions are disabled and show an in-progress state consistent with existing UX.",
        "While a full clip is generating/uploading, both actions are disabled and show an in-progress state consistent with existing UX.",
        "If the user changes the prompt text after a sample preview, the UI clearly resets/invalidates the old preview playback so it’s obvious it no longer matches the current prompt."
      ]
    }
  ],
  "constraints": [
    "Do not edit files in frontend/immutablePaths (e.g., frontend/src/hooks/useInternetIdentity.ts(x), frontend/src/hooks/useActor.ts, frontend/src/main.tsx, frontend/src/components/ui).",
    "Keep backend architecture as a single Motoko actor in backend/main.mo; add backend changes only if strictly necessary for this feature."
  ],
  "nonGoals": [
    "Implementing third-party AI/video generation integrations or external APIs for sample generation.",
    "Adding new authentication methods beyond Internet Identity.",
    "Adding real-time streaming previews (e.g., WebSockets) or live rendering over the network."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}