{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Add sample preview generation before full clip generation and download",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Add a user-facing \"Preview sample\" action that generates and plays a short preview clip from the current prompt before full generation.",
      "acceptanceCriteria": [
        "On the Create flow, users can trigger a \"Preview sample\" action that generates a short preview clip (shorter than the configured full duration) from the current prompt.",
        "After a sample preview completes, the UI plays the sample preview in the existing preview player area.",
        "The sample preview action is clearly labeled in English (e.g., \"Preview sample\") and is available before running full generation."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/TextInput.tsx",
          "operation": "modify",
          "description": "Update the Create-flow prompt input actions to present a clearly labeled \"Preview sample\" button alongside the existing generation CTA. Keep prompt validation consistent; ensure the preview action is available prior to full generation."
        },
        {
          "path": "frontend/src/components/ScenePreview.tsx",
          "operation": "modify",
          "description": "Add a sample-preview generation mode that runs the same local rendering/recording pipeline but uses a shorter duration than the configured full duration, then plays the result in the existing preview player area. Use the blob-storage ExternalBlob capability (create ExternalBlob from bytes and render via getBytes()/getDirectURL patterns as appropriate) to manage preview playback data; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/CreatePage.tsx",
          "operation": "modify",
          "description": "Wire the new \"Preview sample\" action into the Create flow by adding state to trigger sample generation and pass the necessary mode/trigger props into ScenePreview so preview generation can be initiated independently of full generation."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "Ensure sample preview generation is ephemeral and does not persist to the user's library or call backend create mutations.",
      "acceptanceCriteria": [
        "After generating a sample preview, the user’s Video Library does not show a new item created by the preview.",
        "No backend \"addVideo\" / \"addAudio\" / \"addBackgroundMusic\" / \"addSceneConfig\" mutations are executed as part of sample preview generation.",
        "Refreshing the page after only generating a sample preview does not reveal any new saved media artifacts."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/ScenePreview.tsx",
          "operation": "modify",
          "description": "Refactor generation so the sample-preview path never calls the existing persistence/upload logic (React Query mutations for addVideo/addAudio/addBackgroundMusic/addSceneConfig). Ensure the preview output is handled only in-memory (e.g., object URL / ExternalBlob in component state) and is discarded on refresh. Use the blob-storage ExternalBlob capability only for in-memory handling (no backend saves); verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/components/VideoLibrary.tsx",
          "operation": "modify",
          "description": "Confirm library loading and display behavior remains tied only to persisted videos returned from the backend, and add any necessary client-side safeguards to avoid accidentally displaying sample-preview artifacts (which should not be persisted)."
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "Add a distinct \"Generate full clip\" action that preserves the existing full workflow (save to library + download) and retains Internet Identity login gating.",
      "acceptanceCriteria": [
        "A distinct \"Generate full clip\" action is available and triggers the existing full pipeline (including upload to the user library).",
        "After full generation completes, the existing download control works as it does today for the generated full clip.",
        "Generating a full clip still requires Internet Identity login (same gating behavior as current generation)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/TextInput.tsx",
          "operation": "modify",
          "description": "Replace/rename the existing single generation CTA to a distinct \"Generate full clip\" action while keeping the current Internet Identity login gating behavior (trigger login when unauthenticated)."
        },
        {
          "path": "frontend/src/components/ScenePreview.tsx",
          "operation": "modify",
          "description": "Separate sample-preview vs full-generation execution paths: full generation must continue to run the current pipeline including backend persistence and then enable the existing download behavior for the full clip. Ensure the download control is associated with the full-generation result (and not required for sample preview). Use the blob-storage ExternalBlob capability as currently used for recorded video bytes and playback/download; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/VideoGenerator.tsx",
          "operation": "modify",
          "description": "Wire the distinct \"Generate full clip\" action into the tabbed Create flow (VideoGenerator page) so it triggers the existing full pipeline and preserves login gating, independent from the sample-preview action."
        }
      ]
    },
    {
      "id": "REQ-4",
      "summary": "Update the Create UI to show both actions with clear in-progress/disabled states and invalidate prior previews when the prompt changes.",
      "acceptanceCriteria": [
        "While a sample preview is generating, both preview and full generation actions are disabled and show an in-progress state consistent with existing UX.",
        "While a full clip is generating/uploading, both actions are disabled and show an in-progress state consistent with existing UX.",
        "If the user changes the prompt text after a sample preview, the UI clearly resets/invalidates the old preview playback so it’s obvious it no longer matches the current prompt."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/TextInput.tsx",
          "operation": "modify",
          "description": "Implement dual-action disabled/in-progress UX: when either sample preview or full generation is in progress, disable both buttons and reflect progress text consistent with the current style (e.g., spinner + label). Ensure prompt textarea/examples remain appropriately disabled when generation is in progress."
        },
        {
          "path": "frontend/src/pages/CreatePage.tsx",
          "operation": "modify",
          "description": "Add parent-level state that prevents simultaneous triggers (sample vs full) and resets/invalidates any previous preview playback when the prompt changes (e.g., by resetting the preview trigger/result state passed into ScenePreview)."
        },
        {
          "path": "frontend/src/pages/VideoGenerator.tsx",
          "operation": "modify",
          "description": "Mirror the same dual-action state management in the tabbed Create flow so both actions are mutually exclusive during processing, and prompt changes invalidate the existing preview playback/result to avoid mismatch."
        },
        {
          "path": "frontend/src/components/ScenePreview.tsx",
          "operation": "modify",
          "description": "Support explicit invalidation/reset behavior when the prompt changes after a sample preview (e.g., clear the current playback state and show a \"preview out of date\"/ready state). Ensure generation-in-progress state is surfaced so parent UI can disable both actions."
        }
      ]
    }
  ]
}